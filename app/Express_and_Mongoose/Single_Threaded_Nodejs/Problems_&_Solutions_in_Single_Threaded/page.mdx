# Problems With Single Threaded Server
## тЪая╕П рзи. **Single-threaded Server ржПрж░ рж╕ржорж╕рзНржпрж╛:**

- ржпржжрж┐ ржПржХржЯрж┐ ржХрж╛ржЬ ржЕржирзЗржХ рж╕ржорзЯ ржирзЗрзЯ (ржпрзЗржоржи: ржмрзЬ ржлрж╛ржЗрж▓ ржкрзЬрж╛), рждржЦржи рж╕рж╛рж░рзНржнрж╛рж░ ржЖржЯржХрзЗ ржпрж╛рзЯред
- рж╕рж╛рж░рзНржнрж╛рж░ рждржЦржи ржЕржирзНржп ржХрзНрж▓рж╛рзЯрзЗржирзНржЯрзЗрж░ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржирж┐рждрзЗ ржкрж╛рж░рзЗ ржирж╛ред
- Heavy CPU ржХрж╛ржЬ рж╕рж╛рж░рзНржнрж╛рж░ ржмрзНрж▓ржХ ржХрж░рзЗ ржлрзЗрж▓рзЗред

---

## ЁЯТ╗ рзй. **I/O Operation vs CPU Operation**

| Operation | ржмрж░рзНржгржирж╛ | ржЙржжрж╛рж╣рж░ржг |
| --- | --- | --- |
| I/O-bound | Input/Output ржХрж╛ржЬ, ржпрж╛ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзЗ (waiting) | ржлрж╛ржЗрж▓ ржкрзЬрж╛, ржирзЗржЯржУрзЯрж╛рж░рзНржХ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ, ржбрзЗржЯрж╛ржмрзЗржЬ ржХрзЛрзЯрзЗрж░рж┐ |
| CPU-bound | ржЕржирзЗржХ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ рж▓рж╛ржЧрзЗ, CPU ржЪрж╛ржкрзЗ ржерж╛ржХрзЗ | Image Processing, Encryption, рж▓ржЬрж┐ржХрзНржпрж╛рж▓ ржХрзНржпрж╛рж▓ржХрзБрж▓рзЗрж╢ржи |

---

## ЁЯЪА рзк. **Node.js ржХрзАржнрж╛ржмрзЗ ржПржЗ рж╕ржорж╕рзНржпрж╛рж░ рж╕ржорж╛ржзрж╛ржи ржХрж░рзЗ?**

Node.js рждрж╛рж░ рж╕рж┐ржЩрзНржЧрзЗрж▓-ржерзНрж░рзЗржбрзЗржб ржирзЗржЪрж╛рж░ ржерж╛ржХрж╛ рж╕рждрзНрждрзНржмрзЗржУ ржЕрзНржпрж╛рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ ржЕржкрж╛рж░рзЗрж╢ржиржЧрзБрж▓рзЛ ржжржХрзНрж╖рждрж╛рж░ рж╕рж╛ржерзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ **Event Loop, libuv рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ ржПржмржВ ржПржХржЯрж┐ Thread Pool** ржПрж░ рж╕ржорзНржорж┐рж▓рж┐ржд ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗред ржПржЯрж┐ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржХрзЗ ржиржи-ржмрзНрж▓ржХрж┐ржВ рж░рж╛ржЦрждрзЗ ржПржмржВ ржЙржЪрзНржЪ-ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржмржЬрж╛ржпрж╝ рж░рж╛ржЦрждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред

---

### тЬЕ рж╕ржорж╛ржзрж╛ржирзЗрж░ ржкржжрзНржзрждрж┐:

### рзз. ржиржи-ржмрзНрж▓ржХрж┐ржВ I/O: Node.js ржПрж░ ржнрж┐рждрзНрждрж┐

Node.js ржПрж░ ржорзВрж▓ рж╢ржХрзНрждрж┐ рж╣рж▓рзЛ ржПрж░ **ржиржи-ржмрзНрж▓ржХрж┐ржВ ржЗржиржкрзБржЯ/ржЖржЙржЯржкрзБржЯ (I/O)** ржоржбрзЗрж▓ред 

ржПрж░ ржорж╛ржирзЗ рж╣рж▓рзЛ, ржпржЦржи ржПржХржЯрж┐ I/O ржЕржкрж╛рж░рзЗрж╢ржи (ржпрзЗржоржи ржлрж╛ржЗрж▓ рж░рж┐ржб/рж░рж╛ржЗржЯ, ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ) рж╢рзБрж░рзБ рж╣ржпрж╝, рждржЦржи Node.js ржорзВрж▓ ржерзНрж░рзЗржбржХрзЗ ржмрзНрж▓ржХ ржирж╛ ржХрж░рзЗ рж╕рзЗржЗ ржХрж╛ржЬржЯрж┐ржХрзЗ ржмрзНржпрж╛ржХржЧрзНрж░рж╛ржЙржирзНржбрзЗ ржкрж╛ржарж┐ржпрж╝рзЗ ржжрзЗржпрж╝ред 

ржорзВрж▓ ржерзНрж░рзЗржб рждржЦржи ржЕржирзНржп рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржмрж╛ ржХрж╛ржЬ ржирж┐рждрзЗ рж╕ржорзНржкрзВрж░рзНржг ржлрзНрж░рж┐ ржерж╛ржХрзЗред

### рзи. Event Loop: Node.js ржПрж░ рж╣рж╛рж░рзНржЯ

Event Loop рж╣рж▓рзЛ Node.js ржПрж░ рж░рж╛ржиржЯрж╛ржЗржорзЗрж░ ржорзВрж▓ ржЕржВрж╢ред 

ржПржЯрж┐ ржПржХржЯрж┐ ржЕржиржирзНржд рж▓рзБржк ржпрж╛ ржХрзНрж░ржорж╛ржЧржд ржжрзБржЯрж┐ ржЬрж┐ржирж┐рж╕рзЗрж░ ржжрж┐ржХрзЗ ржиржЬрж░ рж░рж╛ржЦрзЗ:

- **Call Stack:** ржПржЯрж┐ ржЬрж╛ржнрж╛рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржХрзЛржбрзЗрж░ ржПржХрзНрж╕рж┐ржХрж┐ржЙрж╢ржи рж╕рзНржЯрзНржпрж╛ржХред ржпржЦржи ржХрзЛржирзЛ ржлрж╛ржВрж╢ржи ржХрж▓ рж╣ржпрж╝, рждрж╛ рж╕рзНржЯрзНржпрж╛ржХрзЗ ржпрзЛржЧ рж╣ржпрж╝ ржПржмржВ ржПржХрзНрж╕рж┐ржХрж┐ржЙрж╢ржи рж╢рзЗрж╖ рж╣рж▓рзЗ рж╕рзНржЯрзНржпрж╛ржХ ржерзЗржХрзЗ ржкржк рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝ред
- **Callback Queue (ржПржмржВ Microtask Queue):** ржпржЦржи ржПржХржЯрж┐ ржЕрзНржпрж╛рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ ржЕржкрж╛рж░рзЗрж╢ржи рж╕ржорзНржкржирзНржи рж╣ржпрж╝, рждржЦржи ржПрж░ рж╕рж╛ржерзЗ ржпрзБржХрзНржд ржХрж▓ржмрзНржпрж╛ржХ ржлрж╛ржВрж╢ржиржЧрзБрж▓рзЛ ржПржХржЯрж┐ рж▓рж╛ржЗржирзЗ (ржХрж┐ржЙ) ржЬржорж╛ рж╣ржпрж╝ред

**ржЗржнрзЗржирзНржЯ рж▓рзБржкрзЗрж░ ржХрж╛ржЬ:**

- ржпржЦржи **Call Stack ржЦрж╛рж▓рж┐ ржерж╛ржХрзЗ**, рждржЦржи ржЗржнрзЗржирзНржЯ рж▓рзБржк `Callback Queue` ржерзЗржХрзЗ ржкрж░ржмрж░рзНрждрзА ржХрж▓ржмрзНржпрж╛ржХ ржлрж╛ржВрж╢ржиржЯрж┐ ржирзЗржпрж╝ред
- ржПржЗ ржХрж▓ржмрзНржпрж╛ржХ ржлрж╛ржВрж╢ржиржЯрж┐ржХрзЗ `Call Stack`ржП ржкрзБрж╢ ржХрж░рзЗ ржПржХрзНрж╕рж┐ржХрж┐ржЙржЯ ржХрж░рж╛рж░ ржЬржирзНржпред
- ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ ржЖржкржирж╛рж░ ржЬрж╛ржнрж╛рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржХрзЛржб (ржпрж╛ рж╕рж┐ржЩрзНржЧрзЗрж▓-ржерзНрж░рзЗржбрзЗ ржЪрж▓рзЗ) ржХржЦржиржЗ I/O ржЕржкрж╛рж░рзЗрж╢ржирзЗрж░ ржЬржирзНржп ржЖржЯржХрзЗ ржерж╛ржХрзЗ ржирж╛ред

### рзй. `libuv`: ржЕрзНржпрж╛рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ ржорзНржпрж╛ржЬрж┐ржХрзЗрж░ ржкрзЗржЫржирзЗ

`libuv` рж╣рж▓рзЛ ржПржХржЯрж┐ C рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ ржпрж╛ Node.js ржПрж░ ржЕрзНржпрж╛рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ I/O ржПржмржВ ржЗржнрзЗржирзНржЯ-ржЪрж╛рж▓рж┐ржд ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░рзЗрж░ ржорзВрж▓ ржнрж┐рждрзНрждрж┐ред 

ржПржЯрж┐ ржЕржкрж╛рж░рзЗржЯрж┐ржВ рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ ржЕрзНржпрж╛рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ ржХрзНрж╖ржорждрж╛ржЧрзБрж▓рзЛржХрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржмржВ ржкрзНрж▓рзНржпрж╛ржЯржлрж░рзНржо-ржирж┐рж░ржкрзЗржХрзНрж╖ ржЙржкрж╛ржпрж╝рзЗ ржЕрзНржпрж╛рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ ржЕржкрж╛рж░рзЗрж╢ржиржЧрзБрж▓рзЛ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рзЗред

`libuv` ржорзВрж▓ржд ржжрзБржЯрж┐ ржнрж┐ржирзНржи ржХрзМрж╢рж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ I/O ржЕржкрж╛рж░рзЗрж╢ржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ:

- **ржЕржкрж╛рж░рзЗржЯрж┐ржВ рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ ржЕрзНржпрж╛рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ API (OS Async API):**
    - ржмрзЗрж╢рж┐рж░ржнрж╛ржЧ **ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ I/O** (ржпрзЗржоржи - HTTP рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ, рж╕ржХрзЗржЯ ржХрж╛ржирзЗржХрж╢ржи) ржЕржкрж╛рж░рзЗржЯрж┐ржВ рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ ржирж┐ржЬрж╕рзНржм ржиржи-ржмрзНрж▓ржХрж┐ржВ ржЕрзНржпрж╛рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ API ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред
    - `libuv` рж╕рж░рж╛рж╕рж░рж┐ ржПржЗ API-ржЧрзБрж▓рж┐рж░ рж╕рж╛ржерзЗ ржЗржирзНржЯрж╛рж░ржЕрзНржпрж╛ржХрзНржЯ ржХрж░рзЗред ржПржЗ ржЕржкрж╛рж░рзЗрж╢ржиржЧрзБрж▓рзЛ ржерзНрж░рзЗржб ржкрзБрж▓рзЗ ржпрж╛рзЯ ржирж╛, ржХрж╛рж░ржг OS ржирж┐ржЬрзЗржЗ ржПржЧрзБрж▓рж┐ ржиржи-ржмрзНрж▓ржХрж┐ржВ ржЙржкрж╛ржпрж╝рзЗ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржПржмржВ ржХрж╛ржЬ рж╢рзЗрж╖ рж╣рж▓рзЗ `libuv` ржХрзЗ ржЕржмрж╣рж┐ржд ржХрж░рзЗред
- **Thread Pool (ржерзНрж░рзЗржб ржкрзБрж▓):**
    - ржХрж┐ржЫрзБ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржзрж░ржирзЗрж░ I/O ржЕржкрж╛рж░рзЗрж╢ржи **ржмрзНрж▓ржХрж┐ржВ ржкрзНрж░ржХрзГрждрж┐рж░** рж╣рждрзЗ ржкрж╛рж░рзЗ, ржЕрж░рзНржерж╛рзО ржПржЧрзБрж▓рж┐ рж╢рзЗрж╖ рж╣рждрзЗ ржпржерзЗрж╖рзНржЯ рж╕ржоржпрж╝ рж▓рж╛ржЧрждрзЗ ржкрж╛рж░рзЗ ржПржмржВ ржорзВрж▓ ржерзНрж░рзЗржбржХрзЗ ржЖржЯржХрзЗ рж░рж╛ржЦрждрзЗ ржкрж╛рж░рзЗред
    - ржПржЗ ржзрж░ржирзЗрж░ ржХрж╛ржЬржЧрзБрж▓рзЛрж░ ржЬржирзНржп (`libuv` ржжрзНржмрж╛рж░рж╛ ржкрж░рж┐ржЪрж╛рж▓рж┐ржд), ржпрзЗржоржи:
        - **ржлрж╛ржЗрж▓ рж╕рж┐рж╕рзНржЯрзЗржо ржЕржкрж╛рж░рзЗрж╢ржи** (ржлрж╛ржЗрж▓ рж░рж┐ржб, рж░рж╛ржЗржЯ)
        - **DNS рж▓рзБржХржЖржк**
        - ржХрж┐ржЫрзБ **ржХрзНрж░рж┐ржкрзНржЯрзЛржЧрзНрж░рж╛ржлрж┐ржХ ржЕржкрж╛рж░рзЗрж╢ржи**
    - `libuv` ржПржХржЯрж┐ ржЕржнрзНржпржирзНрждрж░рзАржг **ржерзНрж░рзЗржб ржкрзБрж▓** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред ржПржЗ ржерзНрж░рзЗржб ржкрзБрж▓рзЗ рж╕рж╛ржзрж╛рж░ржгржд рзкржЯрж┐ ржУржпрж╝рж╛рж░рзНржХрж╛рж░ ржерзНрж░рзЗржб ржерж╛ржХрзЗ (ржпржжрж┐ржУ ржПржЯрж┐ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ ржпрж╛рзЯ)ред `libuv` ржПржЗ ржмрзНрж▓ржХрж┐ржВ ржХрж╛ржЬржЧрзБрж▓рзЛржХрзЗ ржерзНрж░рзЗржб ржкрзБрж▓рзЗрж░ ржПржХржЯрж┐ ржерзНрж░рзЗржбрзЗ ржкрж╛ржарж┐ржпрж╝рзЗ ржжрзЗржпрж╝ред ржерзНрж░рзЗржбржЯрж┐ ржмрзНржпрж╛ржХржЧрзНрж░рж╛ржЙржирзНржбрзЗ ржХрж╛ржЬржЯрж┐ рж╕ржорзНржкржирзНржи ржХрж░рзЗ ржПржмржВ ржХрж╛ржЬ рж╢рзЗрж╖ рж╣рж▓рзЗ `libuv` ржХрзЗ ржЬрж╛ржирж╛ржпрж╝, ржпрж╛ ржкрж░ржмрж░рзНрждрзАрждрзЗ рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ ржХрж▓ржмрзНржпрж╛ржХржХрзЗ `Callback Queue`ржП ржпрзЛржЧ ржХрж░рзЗред

### рзк. ржорзВрж▓ ржерзНрж░рзЗржб (Event Loop) ржПрж░ рж╕рзНржмрж╛ржзрзАржирждрж╛

ржпржЦржи `libuv` рждрж╛рж░ ржерзНрж░рзЗржб ржкрзБрж▓ ржмрж╛ OS Async API ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ I/O ржХрж╛ржЬржЧрзБрж▓рзЛ ржмрзНржпрж╛ржХржЧрзНрж░рж╛ржЙржирзНржбрзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ, рждржЦржи Node.js ржПрж░ **ржорзВрж▓ ржерзНрж░рзЗржб (ржпрзЗржЦрж╛ржирзЗ Event Loop ржЪрж▓рзЗ)** рж╕ржорзНржкрзВрж░рзНржг ржлрзНрж░рж┐ ржерж╛ржХрзЗред ржПржЯрж┐ ржЕржирзНржп ржЗржЙржЬрж╛рж░ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржмрж╛ ржЬрж╛ржнрж╛рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржХрзЛржб ржПржХрзНрж╕рж┐ржХрж┐ржЙржЯ ржХрж░рждрзЗ ржкрж╛рж░рзЗ, ржпрж╛рж░ ржлрж▓рзЗ Node.js ржЙржЪрзНржЪ ржХржиржХрж╛рж░рзЗржирзНрж╕рж┐ (ржПржХржЗ рж╕ржоржпрж╝рзЗ ржЕржирзЗржХржЧрзБрж▓рзЛ ржХрж╛ржЬ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рж╛рж░ ржХрзНрж╖ржорждрж╛) ржЕрж░рзНржЬржи ржХрж░рждрзЗ ржкрж╛рж░рзЗред